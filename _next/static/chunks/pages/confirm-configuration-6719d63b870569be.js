(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[489],{84679:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/confirm-configuration",function(){return t(19742)}])},19742:function(e,s,t){"use strict";t.r(s);var a=t(85893),i=t(67294),r=t(71866),n=t(64146),l=t(8478),c=t(9765),o=t(41518),d=t(87536),h=t(71299),u=t(21237),p=t(80050),x=t(11163),g=t(98064),v=t(37005),m=t(4010),f=t(53576),j=t(28106),w=t(79116);let y=()=>{let e,s;let{account:t,provider:y,chainId:S}=(0,h.kR)(),{handleSubmit:C}=(0,d.cI)({mode:"onChange"}),_=(0,x.useRouter)(),[A,k]=(0,i.useState)(),[b,$]=(0,i.useState)(),[R,N]=(0,i.useState)(!1),[E,I]=(0,i.useState)(""),[O,T]=(0,i.useState)(),[D,W]=(0,i.useState)(),[H,K]=(0,i.useState)(!1),[z,F]=(0,i.useState)(""),P="v1.7.0",[M,Z]=(0,i.useState)(!1),[L,U]=(0,i.useState)(""),[X,Y]=(0,i.useState)(""),J=(0,o.o)(e=>e.clusterDefinition),Q=(null==J?void 0:J.principal)&&!(null==J?void 0:J.singleAddress)&&(null==J?void 0:J.recipients.every(e=>(0,u.H6)(e))),q=!(null==J?void 0:J.principal)&&!(null==J?void 0:J.singleAddress)&&(null==J?void 0:J.recipients.every(e=>(0,u.H6)(e))),V=!(null==J?void 0:J.principal)&&(null==J?void 0:J.singleAddress)&&!(null==J?void 0:J.recipients.every(e=>(0,u.H6)(e)));Q?(e="Rewards",s="Deploy Optimistic Withdrawal Recipient Contract"):q&&(e="Principal & Rewards",s="Deploy Splitter Contract");let B=null==J?void 0:J.operators.some(e=>e.address===t),G=(0,o.o)(e=>e.updateClusterDefinition),ee=(0,o.o)(e=>e.completeLeaderStep),es=(0,o.o)(e=>e.enableLeaderStep),et=()=>{k(null),$(null),I(""),T(""),W(""),N(!1)},ea=e=>{console.log(e),et()},ei=async e=>{let s=await (0,p.c0)({token:e,data:A});if(!s.data.config_hash)throw"no config hash returned";I(s.data.config_hash)};(0,i.useEffect)(()=>{if(A){let e=async()=>{try{let e={creator_config_hash:A.config_hash},s=await (0,u.L6)(y,S,t,e);if(await ei(s),B){let e={operator_config_hash:A.config_hash},s=await (0,u.AM)(y,S,t,e);W(s);let a={enr:null==J?void 0:J.enr},i=await (0,u.Ol)(y,S,t,a);T(i)}}catch(e){ea(e)}};e()}},[A]),(0,i.useEffect)(()=>{if(B&&b&&E||!B&&E){ee("confirm-configuration");let e=es("invite-group");N(!1),_.push({pathname:e.href,query:{configHash:E}})}},[b,E]),(0,i.useEffect)(()=>{if(B&&O&&D&&E){let e=async()=>{let e={address:t,enr:null==J?void 0:J.enr,enr_signature:O,fork_version:c.se,version:P},{data:s}=await (0,p.R)({token:D,data:e,configHash:E});$(s)};e().catch(ea)}},[O,E]);let er=()=>(0,a.jsx)(l.W2,{className:"cluster-details",alignItems:"start",children:(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(j.uo,{}),(0,a.jsx)(r.VL,{operators:[...null==J?void 0:J.operators],currentAccount:t})]})}),en=()=>(0,a.jsxs)(l.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$sm"},children:[(0,a.jsxs)(l.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,a.jsx)(l.xv,{variant:"subline",color:"body",css:{textTransform:"uppercase"},children:"Your Charon client ENR"}),(0,a.jsx)(l.KZ,{content:'An ENR is an "Ethereum Node Record" used to identify your client to the other clients in the cluster"',children:(0,a.jsx)(l.xu,{css:{display:"flex"},children:(0,a.jsx)(l.by,{})})})]}),(0,a.jsx)(r.Kx,{css:{minHeight:"115px"},placeholder:"Your enr",value:null==J?void 0:J.enr,readOnly:!0})]}),(0,a.jsxs)(l.rU,{href:"https://docs.obol.tech/docs/next/int/quickstart/group/quickstart-group-leader-creator#step-2-create-and-back-up-a-private-key-for-charon",target:"_blank",children:["More on Ethereum Node Records ",(0,a.jsx)(l.ZJ,{})]})]}),el=async e=>{let{recipientsAddresses:s,splitPercentages:t,splitMainContract:a}=e;try{let e=await (0,f.s8)(s,t,a);console.log("realSplitAddress",e),G({...J,validators:Array(J.validatorsSize).fill({feeRecipientAddress:e,withdrawalAddress:e})}),F(e);return}catch(s){let e=(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)?(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)[0]:null==s?void 0:s.message;throw console.log(e,"errorMessage"),U(e),s}},ec=async e=>{let{recipientsAddresses:s,splitPercentages:t,predictedSplitAddress:a}=e;try{let{owrAddress:e,splitAddress:i}=await (0,f.KZ)({principalRecipient:J.principal,amountOfPrincipalStake:32*J.validatorsSize},{accounts:s,percentAllocations:t},a,y.getSigner(0));G({...J,validators:Array(J.validatorsSize).fill({feeRecipientAddress:i,withdrawalAddress:e})}),F(i);return}catch(s){let e=(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)?(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)[0]:null==s?void 0:s.message;throw U(e),s}},eo=async e=>{try{let s=await (0,f.Sf)(J.principal,e,32*J.validatorsSize,y.getSigner(0));console.log(s,"OWRecipientContractAddresses"),G({...J,validators:Array(J.validatorsSize).fill({feeRecipientAddress:e,withdrawalAddress:s})}),F(e);return}catch(s){let e=(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)?(null==s?void 0:s.message).match(/^(.*?)(?=\s*\()/)[0]:null==s?void 0:s.message;throw U(e),s}},ed=async e=>{if(e.preventDefault(),!H){K(!0);try{let e=await (0,u.jT)(c.nU,y),s=await (0,u.jT)(c.wi,y),t=await (0,u.jT)(c.eh,y);if(!e||!s||!t){U(c.dK),K(!1);return}let a=[...J.recipients];a.sort((e,s)=>e.address.localeCompare(s.address));let i=a.map(e=>e.address),r=a.map(e=>{let s=(1e4*parseFloat(e.split)).toFixed(0);return parseInt(s)}),l=new n.Contract(c.wi,m.Mt,null==y?void 0:y.getSigner(0)),o=await l.predictImmutableSplitAddress(i,r,c.Uu);console.log("predictedSplitAddress",o);let d=await (0,f.Kv)(o,S);console.log(d,"isSplitterDeployed"),Q?d?(await eo(o),Y(c.Oy)):await ec({recipientsAddresses:i,splitPercentages:r,predictedSplitAddress:o}):q&&(d?(G({...J,validators:Array(J.validatorsSize).fill({feeRecipientAddress:o,withdrawalAddress:o})}),F(o),Y(c.Oy)):await el({recipientsAddresses:i,splitPercentages:r,splitMainContract:l})),K(!1)}catch(e){console.log(e,"errr"),K(!1)}}},eh=(0,i.useMemo)(()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(er,{}),(0,a.jsx)(j.XD,{}),B&&(0,a.jsx)(en,{}),(0,a.jsxs)(l.W2,{className:"withdrawal-section",css:{gap:"$xl"},alignItems:"start",children:[(0,a.jsx)(l.xv,{variant:"h4",children:"Withdrawal Configuration"}),"Rewards"===e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.nB,{heading:"Principal Address",description:"Address to receive validator principal and rewards at exit..",value:null==J?void 0:J.principal,className:"principal-address-section"}),(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$xs"},children:[(0,a.jsxs)(l.xv,{variant:"h5",children:[e," Split"]}),(0,a.jsx)(l.xv,{color:"body",variant:"body",children:"Explainer of what these are"}),(0,a.jsx)(g.I,{recipients:J.recipients,type:e})]}),z&&(0,a.jsxs)(l.W2,{variant:"card",className:"enr-section",alignItems:"start",css:{gap:"$sm",p:"$sm"},children:[(0,a.jsxs)(l.kC,{css:{gap:"$sm"},children:[(0,a.jsx)(l.xu,{children:(0,a.jsx)(l.nQ,{})}),(0,a.jsx)(l.xu,{css:{display:"flex",fd:"column",gap:"$xs"},children:(0,a.jsx)(l.xv,{variant:"body",css:{color:"white"},children:"Optimistic Withdrawal Recipient Contract Successfully Deployed"})})]}),(0,a.jsx)(l.xv,{color:"body",variant:"subline",css:{lineHeight:"$lg",textTransform:"uppercase",letterSpacing:"1px"},children:"Optimistic Withdrawal Recipient Contract Address"}),(0,a.jsx)(l.IK,{readOnly:!0,value:J.validators[0].withdrawalAddress}),(0,a.jsxs)(l.rU,{href:"https://".concat(c.pn,".etherscan.io/address/").concat(J.validators[0].withdrawalAddress,"#code"),target:"_blank",children:["View on Etherscan ",(0,a.jsx)(l.ZJ,{})]})]})]}),"Principal & Rewards"===e&&(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$xs"},children:[(0,a.jsxs)(l.xv,{variant:"h5",children:[e," Split"]}),(0,a.jsx)(l.xv,{color:"body",variant:"body",children:"Explainer of what these are"}),(0,a.jsx)(g.I,{recipients:J.recipients,type:e,validatorsSize:J.validators.length})]}),z&&(0,a.jsxs)(l.W2,{variant:"card",className:"enr-section",alignItems:"start",css:{gap:"$sm",p:"$sm"},children:[(0,a.jsxs)(l.kC,{css:{gap:"$sm"},children:[(0,a.jsx)(l.xu,{children:(0,a.jsx)(l.nQ,{})}),(0,a.jsx)(l.xu,{css:{display:"flex",fd:"column",gap:"$xs"},children:(0,a.jsx)(l.xv,{variant:"body",css:{color:"white"},children:"Splitter Contract Successfully Deployed"})})]}),(0,a.jsx)(l.xv,{color:"body",variant:"subline",css:{lineHeight:"$lg",textTransform:"uppercase",letterSpacing:"1px"},children:"Splitter Contract Address"}),(0,a.jsx)(l.IK,{readOnly:!0,value:z}),(0,a.jsxs)(l.rU,{href:"https://".concat(c.pn,".etherscan.io/address/").concat(z,"#code"),target:"_blank",children:["View on Etherscan ",(0,a.jsx)(l.ZJ,{})]})]}),!z&&(0,a.jsx)(r.fl,{color:"primary",type:"button",onClick:ed,disabled:!!L,children:(0,a.jsxs)(a.Fragment,{children:[H&&(0,a.jsx)(l.yC,{}),s]})}),X&&(0,a.jsx)(l.xv,{variant:"metadata",color:"testHover",children:X}),L&&(0,a.jsx)(l.xv,{variant:"metadata",color:"test",children:L})]})]}),[z,H,L,J]),eu=(0,i.useMemo)(()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(er,{}),(0,a.jsx)(j.XD,{}),B&&(0,a.jsx)(en,{}),(0,a.jsx)(w.vI,{singleAddress:null==J?void 0:J.singleAddress,feeRecipientAddress:null==J?void 0:J.feeRecipientAddress})]}),[J]);if(!J)return(0,a.jsx)(l.xv,{children:"No cluster data ..."});let ep=async()=>{if(R)return;console.log(JSON.stringify(J),"currentClusterData");let e=(0,u.KH)(J,P);console.log(e.config_hash,"config_hashconfig_hash"),k(e),N(!0)};return(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(l.xv,{variant:"h3",children:"Confirm Configuration"}),(0,a.jsx)(r.l0,{onSubmit:C(ep),children:(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(v.T,{name:"reward_split_withdrawal_flow",children:Q&&eh}),(0,a.jsx)(v.T,{name:"split_withdrawal_flow",children:q&&eh}),(0,a.jsx)(v.T,{name:"single_withdrawal_address_flow",children:V&&eu}),(0,a.jsx)(l.kC,{direction:"column",css:{gap:"$lg"},children:(0,a.jsxs)(l.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,a.jsx)(l.kC,{direction:"column",css:{gap:"$xs"},children:(0,a.jsx)(l.xv,{variant:"h4",children:"Confirm Details "})}),(0,a.jsxs)(l.kC,{direction:"column",css:{gap:"$xl"},children:[(0,a.jsxs)(l.kC,{css:{gap:"$xs",width:"$full"},children:[(0,a.jsx)(l.xu,{children:(0,a.jsx)(l.XZ,{checked:M,onCheckedChange:()=>Z(!M)})}),(0,a.jsx)(l.xv,{variant:"body",children:"You will be prompted to sign a message with your wallet. This signature is attesting to the fact that:"})]}),(0,a.jsx)(l.sQ,{heading:"You have confirmed the withdrawal address for the validators to be created is correct. If this address is a contract, you have confirmed the contract implementation is correct. If this address is an externally-owned account, you have confirmed that the EOA custody is secure."}),(0,a.jsx)(l.sQ,{heading:"You have submitted your charon node's Ethereum Node Record (ENR) correctly. This signature is the authorisation of this charon client to act on your behalf."})]}),(0,a.jsx)(r.fl,{color:"primary",type:"submit",disabled:!V&&!z||!M,children:(0,a.jsxs)(a.Fragment,{children:[R&&(0,a.jsx)(l.yC,{}),"Confirm and Sign"]})})]})})]})})]})};s.default=y,y.layout="ProgressTrackerLayout"}},function(e){e.O(0,[774,888,179],function(){return e(e.s=84679)}),_N_E=e.O()}]);